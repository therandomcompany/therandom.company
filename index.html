<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>therandom.company</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Mono', monospace;
            background-color: #fff;
            color: #000;
            max-width: 120ch;
            margin: 0;
            line-height: 1.5;
            font-size: 1rem;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding: 2rem;
            padding-bottom: 0;
        }

        .container {
            background-color: #fff;
            padding: 0;
            position: relative;
        }

        .container::before {
            position: absolute;
            top: 1rem;
            left: 0;
            color: #000;
            opacity: 0.3;
        }

        h1 {
            font-size: 3rem;
            margin: 2rem 0;
            color: #000;
        }

        h2 {
            font-size: 2rem;
            margin: 2rem 0 1rem;
            color: #000;
        }

        h3 {
            font-size: 1.25rem;
            margin: 1.5rem 0;
            color: #000;
        }

        p {
            margin: 1rem 0;
            color: #000;
        }

        ul {
            margin: 2rem 0;
            list-style: none;
        }

        li {
            margin: 2rem 0;
            position: relative;
            padding-left: 1.5rem;
        }

        li::before {
            content: ">";
            position: absolute;
            left: 0;
            top: 0.2em;
            color: #000;
            opacity: 0.3;
        }

        .section {
            margin: 4rem 0;
            position: relative;
        }

        .truth {
            font-style: italic;
            padding: 1rem;
            border-left: 1px solid #000;
            margin: 2rem 0;
            background-color: #f8f8f8;
        }

        a {
            color: #000;
            text-decoration: none;
            border-bottom: 1px solid #000;
        }

        a:hover {
            opacity: 0.7;
        }

        @media (max-width: 600px) {
            body {
                padding: 1rem;
                font-size: 0.875rem;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            h3 {
                font-size: 1.125rem;
            }
        }

        .what-we-dont {
            margin-bottom: 4rem;
        }

        .what-we-do {
            margin-top: 4rem;
        }

        .cursor {
            display: inline-block;
            width: 0.5em;
            height: 1em;
            background-color: #000;
            margin-left: 0.1em;
            animation: blink 1s step-end infinite;
            vertical-align: middle;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        .command::after {
            content: "|";
            display: inline-block;
            animation: blink 1s step-end infinite;
            margin-left: 0.1em;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #fff;
            padding: 2rem;
            border-radius: 4px;
            max-width: 80%;
            width: 600px;
        }

        .command-input {
            position: fixed;
            bottom: 1.5rem;
            left: 0;
            right: 0;
            background: #8e44ad;
            color: #fff;
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            display: none;
            transition: all 0.3s ease;
            z-index: 999;
            height: 1.5rem;
            line-height: 1.5rem;
            display: flex;
            align-items: center;
        }

        .command-input.show {
            display: flex;
            animation: slideIn 0.3s ease;
        }

        .command-input:not(.show) {
            display: none;
        }

        .command-input .colon {
            color: #fff;
            opacity: 0.7;
            margin-right: 0.5rem;
        }

        .command-input.search-mode .colon {
            display: none;
        }

        .command-input .command-text {
            flex: 1;
            background: none;
            border: none;
            color: #fff;
            font-family: 'Space Mono', monospace;
            font-size: 0.875rem;
            outline: none;
        }

        .command-input .command-text::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .search-highlight {
            background-color: rgba(241, 196, 15, 0.3);
            position: absolute;
            pointer-events: none;
            z-index: 100;
        }

        .visual-selection {
            position: absolute;
            background-color: rgba(52, 152, 219, 0.3);
            pointer-events: none;
            z-index: 100;
            transition: all 0.1s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .note {
            font-size: 0.875rem;
            color: #666;
            font-style: italic;
            margin: 1.5rem 0;
            text-align: left;
            line-height: 1.6;
        }

        .game-container {
            margin: 2rem 0;
            text-align: left;
        }

        #gameCanvas {
            border: 1px solid #000;
            background: #fff;
            margin-bottom: 1rem;
            max-width: 100%;
        }

        .game-controls {
            display: flex;
            gap: 1rem;
            justify-content: flex-start;
            align-items: center;
            flex-wrap: wrap;
        }

        .game-controls button {
            background: #000;
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            font-family: 'Space Mono', monospace;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .game-controls button:hover {
            opacity: 0.8;
        }

        .vim-mode {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #2d3436;
            color: #fff;
            padding: 0.15rem 0.5rem;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            transform-origin: bottom;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            z-index: 1000;
            height: 1.5rem;
            line-height: 1.5rem;
        }

        .vim-mode .mode-text {
            font-weight: bold;
            padding: 0.15rem 0.3rem;
            border-radius: 0;
            margin: -0.15rem -0.5rem;
            display: inline-block;
            width: auto;
            min-width: 4rem;
            text-align: center;
        }

        .vim-mode.normal .mode-text {
            background-color: #2ecc71; /* Vim normal mode green */
        }

        .vim-mode.insert .mode-text {
            background-color: #3498db; /* Vim insert mode blue */
        }

        .vim-mode.command .mode-text {
            background-color: #8e44ad; /* Vim command mode purple */
        }

        .vim-mode.visual .mode-text {
            background-color: #f39c12; /* Vim visual mode orange */
        }

        .vim-mode.search .mode-text {
            background-color: #f1c40f; /* Vim search mode yellow */
        }

        .vim-mode .file-info {
            color: #000;
            background-color: #e0e0e0;
            padding: 0.15rem 0.3rem;
            border-radius: 0;
            margin: -0.15rem 0.5rem;
            display: inline-block;
        }

        .vim-mode .cursor-position {
            color: rgba(255, 255, 255, 0.7);
            margin-left: auto;
        }

        .vim-cursor {
            display: inline-block;
            width: 0.5em;
            height: 1em;
            background-color: #000;
            margin-left: 0.1em;
            animation: blink 1s step-end infinite;
            vertical-align: middle;
        }

        .vim-highlight {
            background-color: rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s ease;
        }

        .insert-mode-hint {
            display: none; /* Hide the old insert mode hint */
        }

        .search-input {
            position: fixed;
            bottom: 1.5rem;
            left: 0;
            right: 0;
            background: #f1c40f;
            color: #000;
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            border: none;
            outline: none;
            font-family: 'Space Mono', monospace;
            display: none;
            transition: all 0.3s ease;
            z-index: 999;
            height: 1.5rem;
            line-height: 1.5rem;
        }

        .search-input.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .search-count {
            position: fixed;
            bottom: 1.5rem;
            right: 0;
            background: #f1c40f;
            color: #000;
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            display: none;
            transition: all 0.3s ease;
            z-index: 999;
            height: 1.5rem;
            line-height: 1.5rem;
        }

        .search-count.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .interactive-section {
            margin: 2rem 0;
            font-family: 'Space Mono', monospace;
            position: relative;
            padding-bottom: 4rem; /* Add padding to prevent content from being hidden behind the input */
        }

        .philosophy-output {
            margin-bottom: 1rem;
            min-height: 200px;
            white-space: pre-wrap;
            line-height: 1.5;
            overflow-y: visible;
            position: relative;
        }

        .command-line {
            display: none;
        }

        .current-input-line {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .prompt {
            color: #000;
            opacity: 0.7;
            white-space: nowrap;
        }

        .philosophy-input {
            background: none;
            border: none;
            font-family: 'Space Mono', monospace;
            font-size: 1rem;
            color: #000;
            flex: 1;
            outline: none;
            width: 100%;
            display: inline;
        }

        .philosophy-input::placeholder {
            color: #000;
            opacity: 0.3;
        }

        .philosophy-line {
            margin: 0.5rem 0;
        }

        .philosophy-line .question {
            color: #000;
            opacity: 0.7;
        }

        .philosophy-line .answer {
            color: #000;
            margin-left: 1rem;
        }

        .philosophy-line .answer.yes {
            color: #2ecc71;
        }

        .philosophy-line .answer.no {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <section class="section intro">
            <h1>therandom.company</h1>
            <p>We embrace randomness. We are a collective exploring creation through chance.</p>
        </section>

        <section class="section manifesto">
            <div class="truth">
                "Where curiosity meets the unexpected, true creation is born. We champion randomness, existing not to scale, but to explore."
            </div>
        </section>

        <section class="section random-path">
            <h2 class="command">$ ./what_is_random</h2>
            <p>Experience the beauty of chaos. Where your curiosity meets randomness, true creation emerges.</p>
            <p>Use arrow keys to guide the particle, but remember: true beauty lies in the unexpected. Let your curiosity guide you through the unknown.</p>
            <div class="game-container">
                <canvas id="gameCanvas"></canvas>
                <div class="game-controls">
                    <button id="startGame">Start</button>
                    <button id="resetGame">Reset</button>
                </div>
            </div>
        </section>

        <p class="note">These are merely our thoughts and beliefs. We have no interest in debating their correctness or engaging in arguments. The validity of these ideas will be proven through our life's journey.</p>

        <section class="section stance" id="stanceSection" style="display: none;">
            <div class="what-we-dont">
                <h2 class="command">$ ./philosophy_check</h2>
                <div class="interactive-section">
                    <p class="note">Hint: You don't necessarily need to answer these questions. We are engineers ourselves at `therandom.company` and trust your ability to find hints within the source code (perhaps at a place like `github.com/therandomcompany`?).</p>
                    <div id="philosophyOutput" class="philosophy-output"></div>
                </div>
            </div>
        </section>

        <section class="section stance" id="weNeverDoSection" style="display: none;">
            <div class="what-we-dont">
                <h2 class="command">$ cat we_never_do.txt</h2>
                <ul>
                    <li>
                        <h3>Compete</h3>
                        <p>Marketing funnels. Sales pitches. Competitive analysis. We reject your entire framework. Nothing in this world is truly comparable—we create our vision without forcing it on others.</p>
                    </li>
                    <li>
                        <h3>Dance with VCs</h3>
                        <p>We don't need advice from those who've never created. Your \"pattern matching\" is fear of the unknown, your advice comes with unwanted constraints. We dance only with those who create or dare to create, and deeply resonate with our vision.</p>
                    </li>
                    <li>
                        <h3>Plan</h3>
                        <p>Your obsession with goals and KPIs suffocates human creativity. Your numerical target setting, beloved by VCs, constrains the natural flow of innovation. We don't chain ourselves to artificial targets—we let true creation emerge.</p>
                    </li>
                    <li>
                        <h3>Labor-Intensive Growth</h3>
                        <p>We reject the labor-intensive model where growth depends on headcount. Scaling through human resources is a path we refuse to take. Small, few, and autonomous—that is our justice.</p>
                    </li>
                    <li>
                        <h3>Waste Time on Non-Essentials</h3>
                        <p>We don't spend time explaining ourselves to those who won't understand. No pointless meetings, no unnecessary documentation. Our time is for creation, not justification.</p>
                    </li>
                    <li>
                        <h3>Show Off</h3>
                        <p>We don't dress up to please others. No vanity, no self-aggrandizing gestures. We focus on what matters—not what makes us look good to the world.</p>
                    </li>
                </ul>
            </div>
        </section>

        <section class="section stance" id="weAlwaysDoSection" style="display: none;">
            <div class="what-we-do">
                <h2 class="command">$ cat we_always_do.txt</h2>
                <ul>
                    <li>
                        <h3>Follow Pure Curiosity</h3>
                        <p>We are faithful to one thing only—our curiosity. Nothing is impossible, we just do it. This is not work, this is play guided by wonder.</p>
                    </li>
                    <li>
                        <h3>Trust Chaos</h3>
                        <p>True creation emerges where curiosity meets randomness. We embrace the unknown as our playground. Beautiful chaos is our natural state.</p>
                    </li>
                    <li>
                        <h3>Celebrate Laziness</h3>
                        <p>Laziness is not a vice—it's the source of true creation. We build autonomous systems that let us stay lazy. This is how we should be.</p>
                    </li>
                    <li>
                        <h3>Pursue Smallness</h3>
                        <p>We are not a stepping stone to something bigger. Small, autonomous structures moving with truth kill grand fictions. Our size is not our limitation—it's our weapon.</p>
                    </li>
                    <li>
                        <h3>Create with True Resonance</h3>
                        <p>We create only what we truly believe in. Those who deeply resonate will find us naturally, and together we build what we love. No convincing, no compromises.</p>
                    </li>
                    <li>
                        <h3>Remain Forever Open</h3>
                        <p>We believe in open source—not just for code, but as a way of being. Our minds and structures follow the same principle: open for all to see, explore, and build upon.</p>
                    </li>
                </ul>
            </div>
        </section>

        <section class="section projects" id="projectsSection" style="display: none;">
            <h2 class="command">$ ls projects/</h2>
            <ul>
                <li>
                    <h3>sourcetool/</h3>
                    <p>Pure creation emerges from pure logic. Internal tools should be an extension of thought—a natural flow from backend wisdom to interface reality.</p>
                    <p>We embrace true laziness by letting backend code speak directly to human interaction. No layers of translation, no frontend complexity. Just the essence of functionality materializing through type-safe truth.</p>
                    <p>This is our expression of autonomous systems, where creation flows naturally from a single source of understanding.</p>
                    <p><a href="https://trysourcetool.com">cd sourcetool/</a></p>
                </li>
            </ul>
        </section>

        <section class="section goodbye" id="goodbyeSection" style="display: none;">
            <div class="truth">
                "Goodbye! Our paths may cross again when you're ready to embrace true creation."
            </div>
        </section>
    </div>

    <div class="modal" id="commandModal">
        <div class="modal-content">
            <input type="text" class="command-input" placeholder="Enter command...">
        </div>
    </div>

    <div class="vim-mode normal" id="vimMode">
        <span class="mode-text">NORMAL</span>
        <span class="file-info">index.html</span>
        <span class="cursor-position">1:1</span>
    </div>
    <div class="insert-mode-hint" id="insertModeHint">-- INSERT --</div>
    <div class="command-input" id="commandInput">
        <span class="colon">:</span>
        <input type="text" class="command-text" placeholder="Enter command...">
    </div>

    <script>
        let currentMode = 'NORMAL';
        let visualStart = null;
        let visualEnd = null;
        let visualSelection = null;
        let searchResults = [];
        let currentSearchIndex = -1;
        let lastKeyPress = null;
        let lastKeyTime = 0;
        let scrollTimeout = null;
        let vimEnabled = localStorage.getItem('philosophyCheckPassed') === 'true';
        const modal = document.getElementById('commandModal');
        const modeIndicator = document.getElementById('vimMode');
        const insertModeHint = document.getElementById('insertModeHint');
        const commandInput = document.getElementById('commandInput');

        function createHighlight(element, type) {
            const rect = element.getBoundingClientRect();
            const highlight = document.createElement('div');
            highlight.className = type === 'visual' ? 'visual-highlight' : 'search-highlight';
            highlight.style.top = rect.top + 'px';
            highlight.style.left = rect.left + 'px';
            highlight.style.width = rect.width + 'px';
            highlight.style.height = rect.height + 'px';
            document.body.appendChild(highlight);
            return highlight;
        }

        function removeHighlights() {
            document.querySelectorAll('.visual-highlight, .search-highlight').forEach(el => el.remove());
        }

        function createVisualSelection(start, end) {
            if (visualSelection) {
                visualSelection.remove();
            }
            visualSelection = document.createElement('div');
            visualSelection.className = 'visual-selection';
            
            // Get parent elements of text nodes
            const startElement = start.parentElement;
            const endElement = end.parentElement;
            
            const startRect = startElement.getBoundingClientRect();
            const endRect = endElement.getBoundingClientRect();
            
            const top = Math.min(startRect.top, endRect.top);
            const left = Math.min(startRect.left, endRect.left);
            const width = Math.max(startRect.right, endRect.right) - left;
            const height = Math.max(startRect.bottom, endRect.bottom) - top;
            
            visualSelection.style.top = top + 'px';
            visualSelection.style.left = left + 'px';
            visualSelection.style.width = width + 'px';
            visualSelection.style.height = height + 'px';
            
            document.body.appendChild(visualSelection);
        }

        function updateVisualSelection(direction) {
            if (!visualStart) return;
            
            // Get text nodes
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                {
                    acceptNode: function(node) {
                        // Skip hidden elements
                        const style = window.getComputedStyle(node.parentElement);
                        if (style.display === 'none' || style.visibility === 'hidden') {
                            return NodeFilter.FILTER_REJECT;
                        }
                        // Skip empty text nodes
                        if (!node.textContent.trim()) {
                            return NodeFilter.FILTER_REJECT;
                        }
                        return NodeFilter.FILTER_ACCEPT;
                    }
                }
            );

            const textNodes = [];
            let node;
            while (node = walker.nextNode()) {
                textNodes.push(node);
            }

            const startIndex = textNodes.indexOf(visualStart);
            let endIndex = textNodes.indexOf(visualEnd || visualStart);
            
            switch(direction) {
                case 'j':
                    endIndex = Math.min(endIndex + 1, textNodes.length - 1);
                    break;
                case 'k':
                    endIndex = Math.max(endIndex - 1, 0);
                    break;
                case 'h':
                    if (startIndex > endIndex) {
                        endIndex = Math.max(endIndex - 1, 0);
                    } else {
                        endIndex = Math.min(endIndex - 1, textNodes.length - 1);
                    }
                    break;
                case 'l':
                    if (startIndex > endIndex) {
                        endIndex = Math.max(endIndex + 1, 0);
                    } else {
                        endIndex = Math.min(endIndex + 1, textNodes.length - 1);
                    }
                    break;
            }
            
            visualEnd = textNodes[endIndex];
            createVisualSelection(visualStart, visualEnd);
        }

        function enterInsertMode() {
            currentMode = 'INSERT';
            modeIndicator.querySelector('.mode-text').textContent = 'INSERT';
            modeIndicator.classList.add('insert');
        }

        function enterNormalMode() {
            currentMode = 'NORMAL';
            modeIndicator.querySelector('.mode-text').textContent = 'NORMAL';
            modeIndicator.classList.remove('insert', 'command', 'visual', 'search');
            modeIndicator.classList.add('normal');
            commandInput.classList.remove('show', 'search-mode');
            commandInput.querySelector('.command-text').value = '';
            if (visualSelection) {
                visualSelection.remove();
                visualSelection = null;
            }
            visualStart = null;
            visualEnd = null;
            // Remove search highlights when exiting search mode
            removeHighlights();
            searchResults = [];
            currentSearchIndex = -1;
        }

        function enterCommandMode() {
            currentMode = 'COMMAND';
            modeIndicator.querySelector('.mode-text').textContent = 'COMMAND';
            modeIndicator.classList.add('command');
            commandInput.classList.add('show');
            commandInput.classList.remove('search-mode');
            commandInput.querySelector('.command-text').value = '';
            commandInput.querySelector('.command-text').focus();
        }

        function enterVisualMode() {
            currentMode = 'VISUAL';
            modeIndicator.querySelector('.mode-text').textContent = 'VISUAL';
            modeIndicator.classList.add('visual');
            
            // Get text nodes
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                {
                    acceptNode: function(node) {
                        const style = window.getComputedStyle(node.parentElement);
                        if (style.display === 'none' || style.visibility === 'hidden') {
                            return NodeFilter.FILTER_REJECT;
                        }
                        // Skip empty text nodes
                        if (!node.textContent.trim()) {
                            return NodeFilter.FILTER_REJECT;
                        }
                        return NodeFilter.FILTER_ACCEPT;
                    }
                }
            );
            
            // Select the first text node
            const firstNode = walker.nextNode();
            if (firstNode) {
                visualStart = firstNode;
                visualEnd = firstNode;
                createVisualSelection(visualStart, visualEnd);
            }
        }

        function enterSearchMode() {
            currentMode = 'SEARCH';
            modeIndicator.querySelector('.mode-text').textContent = 'COMMAND';
            modeIndicator.classList.add('command');
            commandInput.classList.add('show', 'search-mode');
            commandInput.querySelector('.command-text').value = '/';
            commandInput.querySelector('.command-text').focus();
        }

        // Update cursor position
        function updateCursorPosition() {
            // Calculate scroll percentage
            const scrollPercentage = Math.round((window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100);
            modeIndicator.querySelector('.cursor-position').textContent = `${scrollPercentage}%`;
        }

        // Add cursor position update listener
        document.addEventListener('selectionchange', updateCursorPosition);
        document.addEventListener('keyup', updateCursorPosition);
        document.addEventListener('click', updateCursorPosition);
        // Add scroll event listener to update percentage
        document.addEventListener('scroll', updateCursorPosition);
        // Initial update
        updateCursorPosition();

        function performSearch(query) {
            removeHighlights();
            searchResults = [];
            
            if (!query) return;
            
            // Remove the leading '/' from the query
            const searchQuery = query.startsWith('/') ? query.slice(1) : query;
            
            // Create a TreeWalker to traverse text nodes
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                {
                    acceptNode: function(node) {
                        // Skip hidden elements
                        const style = window.getComputedStyle(node.parentElement);
                        if (style.display === 'none' || style.visibility === 'hidden') {
                            return NodeFilter.FILTER_REJECT;
                        }
                        return NodeFilter.FILTER_ACCEPT;
                    }
                }
            );
            
            let node;
            while (node = walker.nextNode()) {
                const text = node.textContent;
                let index = 0;
                
                while ((index = text.toLowerCase().indexOf(searchQuery.toLowerCase(), index)) !== -1) {
                    const range = document.createRange();
                    range.setStart(node, index);
                    range.setEnd(node, index + searchQuery.length);
                    
                    // Get the containing element
                    const element = range.commonAncestorContainer.parentElement;
                    
                    if (element) {
                        searchResults.push({
                            element: element,
                            text: text.substring(index, index + searchQuery.length),
                            range: range,
                            node: node,
                            startOffset: index,
                            endOffset: index + searchQuery.length
                        });
                    }
                    
                    index += searchQuery.length;
                }
            }
            
            // Update search count display
            if (searchResults.length > 0) {
                currentSearchIndex = 0;
                highlightSearchResult();
                commandInput.querySelector('.command-text').value = `/${searchQuery}`;
            } else {
                commandInput.querySelector('.command-text').value = `/${searchQuery}`;
            }
        }

        function highlightSearchResult() {
            if (searchResults.length === 0) return;
            
            // Remove previous highlights
            removeHighlights();
            
            // Highlight all results
            searchResults.forEach((result, index) => {
                try {
                    // Create highlight for the exact text
                    const rect = result.range.getBoundingClientRect();
                    const highlight = document.createElement('div');
                    highlight.className = 'search-highlight';
                    
                    // Add padding to make highlight more visible
                    const padding = 2;
                    highlight.style.top = (rect.top + window.scrollY - padding) + 'px';
                    highlight.style.left = (rect.left + window.scrollX - padding) + 'px';
                    highlight.style.width = (rect.width + padding * 2) + 'px';
                    highlight.style.height = (rect.height + padding * 2) + 'px';
                    
                    // Add tooltip with matched text
                    highlight.title = result.text;
                    
                    // Make current result more visible
                    if (index === currentSearchIndex) {
                        highlight.style.backgroundColor = 'rgba(241, 196, 15, 0.5)';
                    }
                    
                    document.body.appendChild(highlight);
                } catch (e) {
                    console.error('Error highlighting search result:', e);
                }
            });
            
            // Scroll to current result
            const currentResult = searchResults[currentSearchIndex];
            if (currentResult) {
                const rect = currentResult.range.getBoundingClientRect();
                const targetScrollY = rect.top + window.scrollY - (window.innerHeight / 2) + 100;
                const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
                const finalScrollY = Math.max(0, Math.min(targetScrollY, maxScroll));
                
                window.scrollTo({
                    top: finalScrollY,
                    behavior: 'smooth'
                });
            }
        }

        // Add click handlers for interactive elements
        document.querySelectorAll('a, input, textarea').forEach(element => {
            element.addEventListener('click', () => {
                if (currentMode === 'NORMAL') {
                    enterInsertMode();
                }
            });
        });

        // Vim-like keyboard shortcuts
        function handleVimKeydown(e) {
            if (!vimEnabled) {
                return;
            }
            
            if (game && game.isRunning) {
                if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                    e.preventDefault();
                    return;
                }
            }

            if (e.key === ':' && currentMode === 'NORMAL') {
                e.preventDefault();
                enterCommandMode();
            } else if (e.key === '/' && currentMode === 'NORMAL') {
                e.preventDefault();
                enterSearchMode();
            } else if (e.key === 'Escape') {
                if (currentMode === 'COMMAND' || currentMode === 'SEARCH') {
                    enterNormalMode();
                } else if (currentMode === 'INSERT' || currentMode === 'VISUAL') {
                    enterNormalMode();
                }
            } else if (e.key === 'Enter' && (currentMode === 'COMMAND' || currentMode === 'SEARCH')) {
                const command = commandInput.querySelector('.command-text').value;
                if (command.startsWith('/')) {
                    performSearch(command.slice(1));
                } else {
                    executeCommand(command);
                    enterNormalMode();
                }
            } else if (currentMode === 'INSERT') {
                // Allow all input in INSERT mode
                return;
            } else if (currentMode === 'NORMAL') {
                const currentTime = Date.now();
                
                // Handle Ctrl + key combinations
                if (e.ctrlKey) {
                    switch(e.key.toLowerCase()) {
                        case 'd':
                            window.scrollBy(0, window.innerHeight / 2);
                            break;
                        case 'u':
                            window.scrollBy(0, -window.innerHeight / 2);
                            break;
                    }
                    return;
                }
                
                switch(e.key) {
                    case 'j':
                        window.scrollBy(0, 100);
                        break;
                    case 'k':
                        window.scrollBy(0, -100);
                        break;
                    case 'g':
                        if (lastKeyPress === 'g' && currentTime - lastKeyTime < 500) {
                            window.scrollTo(0, 0);
                            lastKeyPress = null;
                            lastKeyTime = 0;
                        } else {
                            lastKeyPress = 'g';
                            lastKeyTime = currentTime;
                        }
                        break;
                    case 'G':
                        window.scrollTo(0, document.body.scrollHeight);
                        break;
                    case 'h':
                        window.history.back();
                        break;
                    case 'l':
                        window.history.forward();
                        break;
                    case 'i':
                        e.preventDefault();
                        enterInsertMode();
                        break;
                    case 'v':
                        e.preventDefault();
                        enterVisualMode();
                        break;
                }
            } else if (currentMode === 'VISUAL') {
                switch(e.key) {
                    case 'h':
                    case 'j':
                    case 'k':
                    case 'l':
                        e.preventDefault();
                        updateVisualSelection(e.key);
                        break;
                    case 'Escape':
                        enterNormalMode();
                        break;
                }
            } else if (currentMode === 'COMMAND') {
                if (commandInput.querySelector('.command-text').value.startsWith('/')) {
                    if (e.key === 'n') {
                        if (searchResults.length > 0) {
                            currentSearchIndex = (currentSearchIndex + 1) % searchResults.length;
                            highlightSearchResult();
                        }
                    } else if (e.key === 'N') {
                        if (searchResults.length > 0) {
                            currentSearchIndex = (currentSearchIndex - 1 + searchResults.length) % searchResults.length;
                            highlightSearchResult();
                        }
                    }
                }
            }
        }

        // Initialize keyboard event listener
        document.addEventListener('keydown', handleVimKeydown);

        function executeCommand(command) {
            switch(command) {
                case 'q':
                    modal.style.display = 'none';
                    break;
                case 'w':
                    modal.style.display = 'none';
                    break;
                case 'wq':
                    modal.style.display = 'none';
                    break;
                case 'help':
                    alert('Available commands:\n:q - Close command mode\n:w - Close command mode\n:wq - Close command mode\n:help - Show this help\n:source - View source code');
                    break;
                case 'source':
                    window.location.href = 'https://github.com/false200/website';
                    break;
                default:
                    alert('Unknown command: ' + command);
            }
        }

        // Random Path Generator Game
        class RandomPathGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.particle = {
                    x: 0,
                    y: 0,
                    vx: 0,
                    vy: 0,
                    size: 4,
                    color: '#000',
                    curiosity: 0
                };
                this.path = [];
                this.isRunning = false;
                this.userInput = { x: 0, y: 0 };
                this.randomness = 0.7;
                this.speed = 2.0;
                this.inputSmoothing = 0.3; // Smoothing factor for input
                
                // Set canvas size
                this.canvas.width = 600;
                this.canvas.height = 400;
                
                // Center the particle
                this.particle.x = this.canvas.width / 2;
                this.particle.y = this.canvas.height / 2;
                
                this.setupEventListeners();
            }

            update() {
                // Update curiosity based on user input
                const inputMagnitude = Math.sqrt(
                    Math.pow(this.userInput.x, 2) +
                    Math.pow(this.userInput.y, 2)
                );

                // Gradually change curiosity based on input magnitude
                this.particle.curiosity += (inputMagnitude - this.particle.curiosity) * 0.1;

                // Smoothly apply user input
                const targetVx = this.userInput.x * this.speed;
                const targetVy = this.userInput.y * this.speed;

                // Apply smoothing only when there is input
                if (this.userInput.x !== 0 || this.userInput.y !== 0) {
                    this.particle.vx += (targetVx - this.particle.vx) * this.inputSmoothing;
                    this.particle.vy += (targetVy - this.particle.vy) * this.inputSmoothing;
                }

                // Interaction between curiosity and randomness
                const curiosityFactor = 0.5 + this.particle.curiosity * 0.5;
                this.particle.vx += (Math.random() - 0.5) * this.randomness * this.speed * curiosityFactor;
                this.particle.vy += (Math.random() - 0.5) * this.randomness * this.speed * curiosityFactor;

                // Decay
                this.particle.vx *= 0.995;
                this.particle.vy *= 0.995;

                this.particle.x += this.particle.vx;
                this.particle.y += this.particle.vy;

                if (this.particle.x < 0 || this.particle.x > this.canvas.width) {
                    this.particle.vx *= -0.9;
                }
                if (this.particle.y < 0 || this.particle.y > this.canvas.height) {
                    this.particle.vy *= -0.9;
                }

                this.particle.x = Math.max(0, Math.min(this.particle.x, this.canvas.width));
                this.particle.y = Math.max(0, Math.min(this.particle.y, this.canvas.height));

                this.path.push({ x: this.particle.x, y: this.particle.y });
            }

            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                // Draw the path
                for (let i = 0; i < this.path.length; i++) {
                    const point = this.path[i];
                    const alpha = Math.max(0, 1 - (this.path.length - i) / 5000);

                    this.ctx.beginPath();
                    this.ctx.moveTo(point.x, point.y);
                    if (i < this.path.length - 1) {
                        this.ctx.lineTo(this.path[i + 1].x, this.path[i + 1].y);
                    }

                    // Change opacity based on curiosity
                    this.ctx.strokeStyle = `rgba(0, 0, 0, ${alpha * 0.3})`;
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                }

                // Draw the particle
                this.ctx.beginPath();
                this.ctx.arc(this.particle.x, this.particle.y, this.particle.size, 0, Math.PI * 2);
                this.ctx.fillStyle = '#000';
                this.ctx.fill();

                // Display curiosity level
                this.ctx.fillStyle = '#000';
                this.ctx.font = '14px Space Mono';
                this.ctx.fillText(`Curiosity: ${Math.round(this.particle.curiosity * 100)}%`, 10, 20);
            }

            resetGame() {
                this.path = [];
                this.particle.x = this.canvas.width / 2;
                this.particle.y = this.canvas.height / 2;
                this.particle.vx = 0;
                this.particle.vy = 0;
                this.particle.curiosity = 0;
                this.isRunning = false;
                const startButton = document.getElementById('startGame');
                startButton.textContent = 'Start';
                this.draw();
            }

            setupEventListeners() {
                // Keyboard controls
                document.addEventListener('keydown', (e) => {
                    switch(e.key) {
                        case 'ArrowLeft':
                            this.userInput.x = -1;
                            break;
                        case 'ArrowRight':
                            this.userInput.x = 1;
                            break;
                        case 'ArrowUp':
                            this.userInput.y = -1;
                            break;
                        case 'ArrowDown':
                            this.userInput.y = 1;
                            break;
                    }
                });

                document.addEventListener('keyup', (e) => {
                    switch(e.key) {
                        case 'ArrowLeft':
                        case 'ArrowRight':
                            this.userInput.x = 0;
                            break;
                        case 'ArrowUp':
                        case 'ArrowDown':
                            this.userInput.y = 0;
                            break;
                    }
                });

                // Button controls
                document.getElementById('startGame').addEventListener('click', () => this.toggleGame());
                document.getElementById('resetGame').addEventListener('click', () => this.resetGame());
            }

            toggleGame() {
                this.isRunning = !this.isRunning;
                const startButton = document.getElementById('startGame');
                startButton.textContent = this.isRunning ? 'Stop' : 'Start';
                if (this.isRunning) {
                    this.animate();
                }
            }

            animate() {
                if (!this.isRunning) return;

                this.update();
                this.draw();
                requestAnimationFrame(() => this.animate());
            }
        }

        // Initialize game when the page loads
        let game;
        window.addEventListener('load', () => {
            game = new RandomPathGame();
            game.draw();
            initPhilosophyCheck();

            // Hide vim mode indicator if philosophy_check is active
            const stanceSection = document.getElementById('stanceSection');
            const vimMode = document.getElementById('vimMode');
            if (!vimEnabled) {
                vimMode.style.display = 'none';
            }
        });

        // Philosophy Check Interactive Feature
        function initPhilosophyCheck() {
            const philosophyData = [
                {
                    question: "Do you want to compete?",
                    text: "Marketing funnels. Sales pitches. Competitive analysis. We reject your entire framework. Nothing in this world is truly comparable—we create our vision without forcing it on others.",
                    expected: "n"
                },
                {
                    question: "Do you want to dance with VCs?",
                    text: "We don't need advice from those who've never created. Your \"pattern matching\" is fear of the unknown, your advice comes with unwanted constraints. We dance only with those who create or dare to create, and deeply resonate with our vision.",
                    expected: "n"
                },
                {
                    question: "Do you want to plan?",
                    text: "Your obsession with goals and KPIs suffocates human creativity. Your numerical target setting, beloved by VCs, constrains the natural flow of innovation. We don't chain ourselves to artificial targets—we let true creation emerge.",
                    expected: "n"
                },
                {
                    question: "Do you want to pursue labor-intensive growth?",
                    text: "We reject the labor-intensive model where growth depends on headcount. Scaling through human resources is a path we refuse to take. Small, few, and autonomous—that is our justice.",
                    expected: "n"
                },
                {
                    question: "Do you want to waste time on non-essentials?",
                    text: "We don't spend time explaining ourselves to those who won't understand. No pointless meetings, no unnecessary documentation. Our time is for creation, not justification.",
                    expected: "n"
                },
                {
                    question: "Do you want to show off?",
                    text: "We don't dress up to please others. No vanity, no self-aggrandizing gestures. We focus on what matters—not what makes us look good to the world.",
                    expected: "n"
                },
                {
                    question: "Do you want to follow pure curiosity?",
                    text: "We are faithful to one thing only—our curiosity. Nothing is impossible, we just do it. This is not work, this is play guided by wonder.",
                    expected: "y"
                },
                {
                    question: "Do you want to trust chaos?",
                    text: "True creation emerges where curiosity meets randomness. We embrace the unknown as our playground. Beautiful chaos is our natural state.",
                    expected: "y"
                },
                {
                    question: "Do you want to celebrate laziness?",
                    text: "Laziness is not a vice—it's the source of true creation. We build autonomous systems that let us stay lazy. This is how we should be.",
                    expected: "y"
                },
                {
                    question: "Do you want to pursue smallness?",
                    text: "We are not a stepping stone to something bigger. Small, autonomous structures moving with truth kill grand fictions. Our size is not our limitation—it's our weapon.",
                    expected: "y"
                },
                {
                    question: "Do you want to create with true resonance?",
                    text: "We create only what we truly believe in. Those who deeply resonate will find us naturally, and together we build what we love. No convincing, no compromises.",
                    expected: "y"
                },
                {
                    question: "Do you want to remain forever open?",
                    text: "We believe in open source—not just for code, but as a way of being. Our minds and structures follow the same principle: open for all to see, explore, and build upon.",
                    expected: "y"
                }
            ];

            const output = document.getElementById('philosophyOutput');
            const stanceSection = document.getElementById('stanceSection');
            const weNeverDoSection = document.getElementById('weNeverDoSection');
            const weAlwaysDoSection = document.getElementById('weAlwaysDoSection');
            const projectsSection = document.getElementById('projectsSection');
            const goodbyeSection = document.getElementById('goodbyeSection');
            let currentIndex = 0;
            let isFirstQuestion = true;

            // Check if user has already completed successfully
            if (localStorage.getItem('philosophyCheckPassed') === 'true') {
                stanceSection.style.display = 'none';
                weNeverDoSection.style.display = 'block';
                weAlwaysDoSection.style.display = 'block';
                projectsSection.style.display = 'block';
                return;
            }
            
            // Allow random access with 1% probability
            const luckyChance = Math.random() < 0.01;
            if (luckyChance) {
                console.log("Embracing randomness: Lucky access granted!");
                stanceSection.style.display = 'none';
                weNeverDoSection.style.display = 'block';
                weAlwaysDoSection.style.display = 'block';
                projectsSection.style.display = 'block';
                localStorage.setItem('philosophyCheckPassed', 'true');
                return;
            }

            // Show the stance section initially
            stanceSection.style.display = 'block';

            function displayQuestion() {
                if (currentIndex >= philosophyData.length) {
                    output.innerHTML += "\nPerfect alignment! You've proven worthy of our vision.";
                    
                    document.querySelector('.interactive-section').style.display = 'none';
                    document.querySelector('.what-we-dont').style.display = 'none';
                    weNeverDoSection.style.display = 'block';
                    weAlwaysDoSection.style.display = 'block';
                    projectsSection.style.display = 'block';
                    localStorage.setItem('philosophyCheckPassed', 'true');
                    
                    // Enable Vim functionality
                    vimEnabled = true;
                    
                    // Restore vim functionality
                    const vimMode = document.getElementById('vimMode');
                    vimMode.style.display = 'flex';
                    currentMode = 'NORMAL';
                    vimMode.querySelector('.mode-text').textContent = 'NORMAL';
                    vimMode.classList.remove('insert', 'command', 'visual', 'search');
                    vimMode.classList.add('normal');
                    
                    // Reset command input
                    const commandInput = document.getElementById('commandInput');
                    commandInput.classList.remove('show', 'search-mode');
                    commandInput.querySelector('.command-text').value = '';
                    
                    // Reset visual selection
                    if (visualSelection) {
                        visualSelection.remove();
                        visualSelection = null;
                    }
                    visualStart = null;
                    visualEnd = null;
                    
                    // Reset search state
                    removeHighlights();
                    searchResults = [];
                    currentSearchIndex = -1;
                    
                    // Re-enable keyboard event listeners
                    document.addEventListener('keydown', handleVimKeydown);
                    return;
                }

                const item = philosophyData[currentIndex];
                output.innerHTML += `\n${item.question} [y/n] `;
                
                // Create inline input element
                const inputLine = document.createElement('div');
                inputLine.className = 'current-input-line';
                
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'philosophy-input';
                input.placeholder = 'y/n';
                input.id = 'currentPhilosophyInput';
                
                output.appendChild(inputLine);
                inputLine.appendChild(input);
                
                // Add event listener to the new input
                input.addEventListener('keydown', handleInput);
                
                // Automatically focus on the input field only for non-first questions
                if (!isFirstQuestion) {
                    input.focus();
                }
                // Mark as not first question for subsequent calls
                isFirstQuestion = false;
            }

            function handleInput(e) {
                if (e.key === 'Enter') {
                    const input = document.getElementById('currentPhilosophyInput');
                    const answer = input.value.toLowerCase().trim();
                    if (answer === 'y' || answer === 'n') {
                        // Replace the input with the answered text
                        const inputLine = input.parentElement;
                        inputLine.innerHTML = answer;
                        
                        const item = philosophyData[currentIndex];
                        const isCorrect = answer === item.expected;
                        
                        output.innerHTML += `\n> ${item.text}\n`;
                        
                        if (!isCorrect) {
                            output.innerHTML += "\nGoodbye! Our paths may cross again when you're ready to embrace true creation.";
                            output.innerHTML += "\n\nPress F5 to try again.";
                            stanceSection.style.display = 'none';
                            goodbyeSection.style.display = 'block';
                            return;
                        }
                        
                        currentIndex++;
                        displayQuestion();
                    }
                }
            }

            // Initialize
            displayQuestion();
            
            // Also disable Vim during philosophy check
            if (stanceSection.style.display === 'block') {
                vimEnabled = false;
                document.removeEventListener('keydown', handleVimKeydown);
            }
        }
    </script>
</body>
</html>
